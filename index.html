<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ - PMS</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
<!-- Supabase JS - Ù…ØµØ¯Ø±ÙŠÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠÙŠÙ† -->
<script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase-js.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Tajawal',sans-serif;background:#F1F5F9;color:#1E293B}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#CBD5E1;border-radius:3px}
input,select,textarea,button{font-family:'Tajawal',sans-serif}
input::placeholder,textarea::placeholder{font-family:'Tajawal',sans-serif;color:#94A3B8}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.fade-in{animation:fadeIn 0.3s ease}
.spinner{animation:spin 1s linear infinite}
.hidden{display:none!important}

/* LOGIN */
.login-wrapper{min-height:100vh;display:flex;background:linear-gradient(135deg,#0C4A6E 0%,#0369A1 40%,#0284C7 70%,#0EA5E9 100%);position:relative;overflow:hidden}
.login-bg1{position:absolute;top:10%;right:5%;width:400px;height:400px;border-radius:50%;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06)}
.login-bg2{position:absolute;bottom:15%;left:10%;width:300px;height:300px;border-radius:50%;background:rgba(255,255,255,0.04)}
.login-bg3{position:absolute;top:50%;right:40%;width:200px;height:200px;border-radius:50%;background:rgba(245,158,11,0.08)}
.login-brand{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:60px;position:relative;z-index:1}
.login-logo{width:90px;height:90px;border-radius:24px;background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);display:flex;align-items:center;justify-content:center;margin:0 auto 30px;border:1px solid rgba(255,255,255,0.2);box-shadow:0 20px 60px rgba(0,0,0,0.15)}
.login-brand h1{font-size:38px;font-weight:900;color:#fff;text-align:center}
.login-brand p{font-size:17px;color:rgba(255,255,255,0.75);margin-top:16px;line-height:1.8;text-align:center}
.login-features{display:flex;justify-content:center;gap:40px;margin-top:50px}
.login-feat{text-align:center}
.login-feat-icon{width:52px;height:52px;border-radius:16px;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;margin:0 auto 10px;border:1px solid rgba(255,255,255,0.15)}
.login-feat span{font-size:12px;color:rgba(255,255,255,0.65);font-weight:500}
.login-form-side{width:520px;display:flex;align-items:center;justify-content:center;padding:40px;position:relative;z-index:1}
.login-card{width:100%;max-width:420px;background:rgba(255,255,255,0.95);backdrop-filter:blur(40px);border-radius:28px;padding:48px 40px;box-shadow:0 30px 80px rgba(0,0,0,0.2)}
.login-card h2{font-size:24px;font-weight:800;color:#0F172A;text-align:center}
.login-card .sub{font-size:14px;color:#64748B;text-align:center;margin:8px 0 36px}
.fg{margin-bottom:20px}
.fg label{display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:8px}
.iw{position:relative}
.iw svg{position:absolute;right:14px;top:50%;transform:translateY(-50%);pointer-events:none}
.iw input{width:100%;padding:14px 44px 14px 16px;border-radius:14px;border:2px solid #E2E8F0;font-size:14px;outline:none;background:#F8FAFC;transition:all 0.3s;direction:ltr;text-align:left}
.iw input:focus{border-color:#0284C7;background:#fff}
.iw .tp{position:absolute;left:14px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;padding:0}
.btn-login{width:100%;padding:16px;border-radius:14px;border:none;font-size:16px;font-weight:700;background:linear-gradient(135deg,#0C4A6E,#0284C7);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.3s;box-shadow:0 4px 20px rgba(12,74,110,0.3)}
.btn-login:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(12,74,110,0.4)}
.btn-login.loading{background:#94A3B8;cursor:default;transform:none}
.login-footer{text-align:center;margin-top:28px;font-size:12px;color:#94A3B8}
.login-error{background:#FEE2E2;color:#DC2626;padding:12px 16px;border-radius:12px;font-size:13px;margin-bottom:16px;display:none;text-align:center;font-weight:600}
.login-success{background:#D1FAE5;color:#047857;padding:12px 16px;border-radius:12px;font-size:13px;margin-bottom:16px;display:none;text-align:center;font-weight:600}
.auth-toggle{text-align:center;margin-top:20px;font-size:13px;color:#64748B}
.auth-toggle a{color:#0284C7;font-weight:600;cursor:pointer;text-decoration:none}

/* LAYOUT */
.sidebar{width:260px;min-height:100vh;background:linear-gradient(180deg,#0C4A6E,#082F49);display:flex;flex-direction:column;position:fixed;right:0;top:0;z-index:100;box-shadow:-4px 0 30px rgba(0,0,0,0.1);transition:width 0.3s}
.sidebar.col{width:80px}
.s-head{padding:24px 20px;border-bottom:1px solid rgba(255,255,255,0.08);display:flex;align-items:center;gap:14}
.sidebar.col .s-head{justify-content:center;padding:24px 15px}
.s-logo{width:42px;height:42px;border-radius:12px;background:rgba(245,158,11,0.2);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.s-title{font-size:16px;font-weight:800;color:#fff;white-space:nowrap}
.s-ver{font-size:10px;color:rgba(255,255,255,0.5)}
.sidebar.col .s-txt{display:none}
.s-nav{flex:1;padding:16px 10px;display:flex;flex-direction:column;gap:4px}
.nav-i{display:flex;align-items:center;gap:14px;padding:14px 16px;border-radius:14px;border:none;cursor:pointer;transition:all 0.2s;background:transparent;width:100%}
.sidebar.col .nav-i{justify-content:center;padding:14px 0}
.nav-i:hover{background:rgba(255,255,255,0.08)}
.nav-i.act{background:rgba(245,158,11,0.15)}
.nav-i span{font-size:14px;font-weight:500;color:rgba(255,255,255,0.75);white-space:nowrap}
.nav-i.act span{color:#F59E0B;font-weight:700}
.sidebar.col .nav-i span,.sidebar.col .nav-dot{display:none}
.nav-dot{margin-right:auto;width:6px;height:6px;border-radius:50%;background:#F59E0B}
.s-foot{padding:16px 10px;border-top:1px solid rgba(255,255,255,0.08)}
.btn-col{display:flex;align-items:center;justify-content:center;width:100%;padding:12px;border-radius:12px;border:none;background:rgba(255,255,255,0.06);cursor:pointer}
.btn-col:hover{background:rgba(255,255,255,0.12)}
.main{flex:1;margin-right:260px;transition:margin-right 0.3s}
.main.col{margin-right:80px}
.header{height:70px;background:#fff;border-bottom:1px solid #E2E8F0;display:flex;align-items:center;justify-content:space-between;padding:0 30px;position:sticky;top:0;z-index:50;box-shadow:0 1px 4px rgba(0,0,0,0.03)}
.header h1{font-size:22px;font-weight:800;color:#0F172A}
.h-acts{display:flex;align-items:center;gap:16px}
.sb{position:relative}.sb svg{position:absolute;right:12px;top:50%;transform:translateY(-50%);pointer-events:none}
.sb input{width:220px;padding:10px 38px 10px 16px;border-radius:12px;border:1px solid #E2E8F0;font-size:13px;outline:none;background:#F8FAFC}
.ui{display:flex;align-items:center;gap:12px;padding-right:16px;border-right:1px solid #E2E8F0}
.ua{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#0C4A6E,#0284C7);display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px;font-weight:700}
.un{font-size:13px;font-weight:700;color:#0F172A}.ur{font-size:11px;color:#94A3B8}
.bl{width:42px;height:42px;border-radius:12px;border:1px solid #FEE2E2;background:#FEF2F2;display:flex;align-items:center;justify-content:center;cursor:pointer}
.pc{padding:30px}

/* COMPONENTS */
.sg{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:24px}
.sc{background:#fff;border-radius:16px;padding:24px 20px;border:1px solid #E2E8F0;display:flex;flex-direction:column;gap:16px;position:relative;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.04);transition:all 0.3s}
.sc:hover{box-shadow:0 4px 16px rgba(0,0,0,0.06)}
.sc-bg{position:absolute;top:-20px;left:-20px;width:80px;height:80px;border-radius:50%;opacity:0.1}
.si{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center}
.sv{font-size:28px;font-weight:800;color:#0F172A;letter-spacing:-0.5px}
.sl{font-size:13px;color:#64748B;margin-top:4px;font-weight:500}
.card{background:#fff;border-radius:16px;padding:24px;border:1px solid #E2E8F0;margin-bottom:20px}
.card-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.card-t{font-size:16px;font-weight:700;color:#0F172A}
.pr{display:flex;align-items:center;gap:10px;width:100%}
.pt{flex:1;height:8px;background:#E2E8F0;border-radius:8px;overflow:hidden}
.pf{height:100%;border-radius:8px;transition:width 1s ease}
.pl{font-size:12px;font-weight:700;min-width:38px;text-align:left}
.badge{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600}
.bd{width:7px;height:7px;border-radius:50%}
.b-act{background:#DBEAFE;color:#1D4ED8}.b-act .bd{background:#3B82F6}
.b-comp{background:#D1FAE5;color:#047857}.b-comp .bd{background:#10B981}
.b-late{background:#FEE2E2;color:#B91C1C}.b-late .bd{background:#EF4444}
.b-new{background:#FEF3C7;color:#92400E}.b-new .bd{background:#F59E0B}
.prio{padding:3px 10px;border-radius:6px;font-size:11px;font-weight:600}
.p-h{background:#FEE2E2;color:#DC2626}.p-m{background:#FEF3C7;color:#D97706}.p-l{background:#D1FAE5;color:#059669}
table.dt{width:100%;border-collapse:collapse}
.dt thead tr{background:#F8FAFC}
.dt th{padding:14px 16px;font-size:12px;font-weight:700;color:#64748B;text-align:right;border-bottom:1px solid #E2E8F0}
.dt td{padding:16px;font-size:13px;border-bottom:1px solid #F1F5F9}
.dt tbody tr{transition:background 0.15s;cursor:pointer}
.dt tbody tr:hover{background:#F8FAFC}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.btn-p{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:12px;border:none;background:linear-gradient(135deg,#0C4A6E,#0284C7);color:#fff;font-size:14px;font-weight:700;cursor:pointer;box-shadow:0 4px 16px rgba(12,74,110,0.3);transition:all 0.2s}
.btn-p:hover{box-shadow:0 6px 20px rgba(12,74,110,0.4);transform:translateY(-1px)}
.btn-s{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:10px;border:1px solid #E2E8F0;background:#fff;font-size:12px;font-weight:600;color:#64748B;cursor:pointer}
.btn-sm{width:30px;height:30px;border-radius:8px;border:1px solid #E2E8F0;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center}
.pc-card{background:#fff;border-radius:16px;padding:24px;border:1px solid #E2E8F0;transition:all 0.3s;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
.pc-card:hover{box-shadow:0 8px 30px rgba(0,0,0,0.08)}
.pm{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:18px;padding-top:16px;border-top:1px solid #F1F5F9}
.pm-i{display:flex;align-items:center;gap:6px;font-size:12px;color:#64748B}
.tc{background:#fff;border-radius:16px;padding:28px;border:1px solid #E2E8F0;text-align:center;transition:all 0.3s}
.tc:hover{box-shadow:0 8px 30px rgba(0,0,0,0.08)}
.t-av{width:72px;height:72px;border-radius:20px;background:linear-gradient(135deg,#0C4A6E,#0284C7);display:flex;align-items:center;justify-content:center;margin:0 auto 16px;font-size:28px;font-weight:800;color:#fff;box-shadow:0 8px 24px rgba(12,74,110,0.25)}
.rc{background:#fff;border-radius:16px;padding:24px;border:1px solid #E2E8F0;cursor:pointer;transition:all 0.3s}
.rc:hover{box-shadow:0 8px 30px rgba(0,0,0,0.08)}
.rc-i{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;margin-bottom:16px}
.cg{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}
.ch{padding:12px;text-align:center;font-size:12px;font-weight:700;color:#64748B;background:#F8FAFC;border-radius:8px}
.cc{padding:10px;min-height:80px;border-radius:8px;border:1px solid #F1F5F9;background:#fff;cursor:pointer}
.cc:hover{background:#F8FAFC}.cc.today{background:#F0F9FF}
.cd{font-size:13px;font-weight:500;color:#1E293B}
.cd.today{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;background:#0284C7;color:#fff;font-weight:800}
.si-inp{width:100%;padding:12px 16px;border-radius:12px;border:1px solid #E2E8F0;font-size:14px;background:#F8FAFC}
.tog{width:48px;height:26px;border-radius:13px;position:relative;cursor:pointer;transition:all 0.3s}
.tog.on{background:#0284C7}.tog.off{background:#E2E8F0}
.tog-k{width:20px;height:20px;border-radius:50%;background:#fff;position:absolute;top:3px;box-shadow:0 1px 4px rgba(0,0,0,0.15);transition:all 0.3s}
.tog.on .tog-k{right:3px}.tog.off .tog-k{right:25px}
.es{text-align:center;padding:60px 20px}
.es-i{width:80px;height:80px;border-radius:20px;background:#F1F5F9;display:flex;align-items:center;justify-content:center;margin:0 auto 20px}
.es-t{font-size:18px;font-weight:700;color:#0F172A;margin-bottom:8px}
.es-d{font-size:14px;color:#94A3B8;margin-bottom:24px}
.as{display:flex;align-items:center;gap:8px}
.as-a{width:28px;height:28px;border-radius:8px;background:#DBEAFE;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#1D4ED8}
.ti{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-radius:12px;background:#F8FAFC;border:1px solid #F1F5F9}
.mo{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;display:none;align-items:center;justify-content:center}
.mo.show{display:flex}
.md{background:#fff;border-radius:20px;padding:32px;width:500px;max-width:90vw;max-height:80vh;overflow-y:auto;animation:fadeIn 0.2s ease}
.md h3{font-size:18px;font-weight:700;color:#0F172A;margin-bottom:24px}
.md .fg{margin-bottom:16px}
.md .fg label{display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:6px}
.md .fg input,.md .fg select,.md .fg textarea{width:100%;padding:10px 14px;border-radius:10px;border:1px solid #E2E8F0;font-size:13px;outline:none;background:#F8FAFC}
.m-acts{display:flex;gap:10px;margin-top:24px}
.btn-c{padding:10px 20px;border-radius:12px;border:1px solid #E2E8F0;background:#fff;font-size:14px;font-weight:600;color:#64748B;cursor:pointer}
.loading-overlay{position:fixed;inset:0;background:rgba(255,255,255,0.8);z-index:2000;display:none;align-items:center;justify-content:center;flex-direction:column;gap:16px}
.loading-overlay.show{display:flex}
.loading-overlay .spinner-lg{width:40px;height:40px;border:4px solid #E2E8F0;border-top:4px solid #0284C7;border-radius:50%;animation:spin 0.8s linear infinite}
/* Connection status */
.conn-status{position:fixed;bottom:20px;left:20px;padding:10px 20px;border-radius:12px;font-size:13px;font-weight:600;z-index:9999;display:none;box-shadow:0 4px 16px rgba(0,0,0,0.1)}
.conn-status.ok{background:#D1FAE5;color:#047857;display:block}
.conn-status.err{background:#FEE2E2;color:#DC2626;display:block}
</style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay"><div class="spinner-lg"></div><span style="font-size:14px;color:#64748B">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></div>
<div class="conn-status" id="connStatus"></div>

<!-- LOGIN -->
<div id="loginPage" class="login-wrapper">
  <div class="login-bg1"></div><div class="login-bg2"></div><div class="login-bg3"></div>
  <div class="login-brand">
    <div>
      <div class="login-logo"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg></div>
      <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h1>
      <p>Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨ÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ©<br>ØªØ®Ø·ÙŠØ· â€¢ ØªÙ†ÙÙŠØ° â€¢ Ù…Ø±Ø§Ù‚Ø¨Ø© â€¢ ØªÙ‚Ø§Ø±ÙŠØ±</p>
      <div class="login-features">
        <div class="login-feat"><div class="login-feat-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="2"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg></div><span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span></div>
        <div class="login-feat"><div class="login-feat-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="2"><path d="M11 18H3"/><path d="m15 18 2 2 4-4"/><path d="M16 12H3"/><path d="M16 6H3"/></svg></div><span>ØªØªØ¨Ø¹ Ø§Ù„Ù…Ù‡Ø§Ù…</span></div>
        <div class="login-feat"><div class="login-feat-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="2"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><path d="M7 16h8"/><path d="M7 11h12"/><path d="M7 6h3"/></svg></div><span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span></div>
      </div>
    </div>
  </div>
  <div class="login-form-side">
    <div class="login-card">
      <h2 id="authTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <p class="sub" id="authSub">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
      <div class="login-error" id="authError"></div>
      <div class="login-success" id="authSuccess"></div>
      <div class="fg" id="nameField" style="display:none"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><div class="iw"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><input id="regName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"></div></div>
      <div class="fg"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><div class="iw"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg><input type="email" id="authEmail" placeholder="example@domain.com"></div></div>
      <div class="fg"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><div class="iw"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><input type="password" id="authPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"><button class="tp" onclick="togglePass()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>
      <button class="btn-login" id="authBtn" type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <div class="auth-toggle" id="authToggle">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a id="toggleLink">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a></div>
      <div class="login-footer">Â© 2025 Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</div>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appPage" class="hidden">
  <div class="sidebar" id="sidebar">
    <div class="s-head"><div class="s-logo"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg></div><div class="s-txt"><div class="s-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="s-ver">PMS v2.0</div></div></div>
    <nav class="s-nav" id="sNav"></nav>
    <div class="s-foot"><button class="btn-col" onclick="togSB()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.6)" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg></button></div>
  </div>
  <div class="main" id="mainC">
    <header class="header">
      <h1 id="pTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
      <div class="h-acts">
        <div class="sb"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg><input placeholder="Ø¨Ø­Ø«..."></div>
        <div class="ui"><div style="text-align:left"><div class="un" id="userName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div><div class="ur">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</div></div><div class="ua" id="userAvatar">Ù…</div></div>
        <button class="bl" onclick="handleLogout()" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#DC2626" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg></button>
      </div>
    </header>
    <div class="pc" id="pageC"></div>
  </div>
</div>

<!-- MODAL -->
<div id="modal" class="mo" onclick="if(event.target===this)closeModal()"><div class="md" id="modalC"></div></div>

<script>
// ============================================================
// SUPABASE CONFIG - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø·
// ============================================================
const SUPABASE_URL = 'https://iaexxprgkjvstviejgot.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhZXh4cHJna2p2c3R2aWVqZ290Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMDMyNTAsImV4cCI6MjA4NzU3OTI1MH0.76sndMnRZZNCz0w1nbuxm0Ja_pbHhHmD5hzaM1w4r6M';

let db = null;
let currentPage = 'dashboard';
let isRegister = false;
let projects = [], tasks = [], teamMembers = [];

// ============================================================
// INITIALIZE SUPABASE
// ============================================================
function initSupabase() {
  try {
    if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
      db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      console.log('âœ… Supabase initialized successfully');
      showConn('Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ“', 'ok');
      return true;
    } else {
      console.error('âŒ Supabase library not loaded');
      showConn('Ø®Ø·Ø£: Ù…ÙƒØªØ¨Ø© Supabase Ù„Ù… ØªØªØ­Ù…Ù„ - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'err');
      return false;
    }
  } catch(e) {
    console.error('âŒ Supabase init error:', e);
    showConn('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + e.message, 'err');
    return false;
  }
}

function showConn(msg, type) {
  const el = document.getElementById('connStatus');
  el.textContent = msg;
  el.className = 'conn-status ' + type;
  if(type === 'ok') setTimeout(() => { el.style.display = 'none'; }, 3000);
}

// ============================================================
// ICONS
// ============================================================
const I = {
  proj:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>',
  task:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 18H3"/><path d="m15 18 2 2 4-4"/><path d="M16 12H3"/><path d="M16 6H3"/></svg>',
  plus:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>',
  del:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#DC2626" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>',
};

const navItems = [
  {id:'dashboard',label:'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>'},
  {id:'projects',label:'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',icon:I.proj},
  {id:'tasks',label:'Ø§Ù„Ù…Ù‡Ø§Ù…',icon:I.task},
  {id:'team',label:'ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„',icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>'},
  {id:'reports',label:'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>'},
  {id:'calendar',label:'Ø§Ù„ØªÙ‚ÙˆÙŠÙ…',icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>'},
  {id:'settings',label:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>'},
];

// ============================================================
// AUTH
// ============================================================
function toggleAuthMode() {
  isRegister = !isRegister;
  document.getElementById('authTitle').textContent = isRegister ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯' : 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
  document.getElementById('authSub').textContent = isRegister ? 'Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ù„Ù„Ø¨Ø¯Ø¡' : 'Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…';
  document.getElementById('authBtn').textContent = isRegister ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨' : 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
  document.getElementById('authToggle').innerHTML = isRegister ? 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a id="toggleLink" onclick="toggleAuthMode()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>' : 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a id="toggleLink" onclick="toggleAuthMode()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>';
  document.getElementById('nameField').style.display = isRegister ? 'block' : 'none';
  hideMessages();
}

function showError(msg) { const el=document.getElementById('authError'); el.textContent=msg; el.style.display='block'; document.getElementById('authSuccess').style.display='none'; }
function showSuccess(msg) { const el=document.getElementById('authSuccess'); el.textContent=msg; el.style.display='block'; document.getElementById('authError').style.display='none'; }
function hideMessages() { document.getElementById('authError').style.display='none'; document.getElementById('authSuccess').style.display='none'; }

async function handleAuth() {
  console.log('ğŸ”„ Auth button clicked');
  const btn = document.getElementById('authBtn');
  const email = document.getElementById('authEmail').value.trim();
  const pass = document.getElementById('authPass').value;
  hideMessages();

  if (!email || !pass) { showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±'); return; }
  if (pass.length < 6) { showError('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'); return; }

  if (!db) {
    if (!initSupabase()) { showError('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.'); return; }
  }

  btn.classList.add('loading');
  btn.innerHTML = '<svg class="spinner" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';

  try {
    if (isRegister) {
      console.log('ğŸ“ Registering:', email);
      const { data, error } = await db.auth.signUp({
        email: email,
        password: pass,
        options: { data: { full_name: document.getElementById('regName').value.trim() || 'Ù…Ø³ØªØ®Ø¯Ù…' } }
      });
      console.log('Register result:', { data, error });
      if (error) throw error;
      
      // Try auto-login
      const loginResult = await db.auth.signInWithPassword({ email, password: pass });
      if (loginResult.error) {
        showSuccess('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø«Ù… Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ.');
        resetAuthBtn(); return;
      }
      enterApp(loginResult.data.user);
    } else {
      console.log('ğŸ”‘ Logging in:', email);
      const { data, error } = await db.auth.signInWithPassword({ email, password: pass });
      console.log('Login result:', { data, error });
      if (error) throw error;
      enterApp(data.user);
    }
  } catch(err) {
    console.error('âŒ Auth error:', err);
    let msg = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
    if (err.message) {
      if (err.message.includes('Invalid login')) msg = 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
      else if (err.message.includes('Email not confirmed')) msg = 'ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹';
      else if (err.message.includes('User already registered')) msg = 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹. Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.';
      else if (err.message.includes('fetch')) msg = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.';
      else msg = err.message;
    }
    showError(msg);
    resetAuthBtn();
  }
}

function resetAuthBtn() {
  const btn = document.getElementById('authBtn');
  btn.classList.remove('loading');
  btn.textContent = isRegister ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨' : 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
}

function togglePass() { const i=document.getElementById('authPass'); i.type=i.type==='password'?'text':'password'; }

async function handleLogout() {
  if(db) await db.auth.signOut();
  document.getElementById('appPage').classList.add('hidden');
  document.getElementById('loginPage').classList.remove('hidden');
  resetAuthBtn(); hideMessages();
}

async function enterApp(user) {
  console.log('âœ… Entering app for user:', user?.email);
  const name = user?.user_metadata?.full_name || user?.email?.split('@')[0] || 'Ù…Ø³ØªØ®Ø¯Ù…';
  document.getElementById('userName').textContent = name;
  document.getElementById('userAvatar').textContent = name.charAt(0);
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('appPage').classList.remove('hidden');
  buildNav();
  await loadAllData();
  navigate('dashboard');
}

// ============================================================
// SESSION CHECK
// ============================================================
async function checkSession() {
  if (!db) return;
  try {
    const { data: { session } } = await db.auth.getSession();
    if (session?.user) { console.log('ğŸ”„ Existing session found'); enterApp(session.user); }
  } catch(e) { console.log('No existing session'); }
}

// ============================================================
// NAV
// ============================================================
function buildNav() {
  document.getElementById('sNav').innerHTML = navItems.map(n => `
    <button class="nav-i ${n.id===currentPage?'act':''}" onclick="navigate('${n.id}')" style="color:${n.id===currentPage?'#F59E0B':'rgba(255,255,255,0.55)'}">
      ${n.icon}<span>${n.label}</span>${n.id===currentPage?'<div class="nav-dot"></div>':''}
    </button>`).join('');
}
function togSB() { document.getElementById('sidebar').classList.toggle('col'); document.getElementById('mainC').classList.toggle('col'); }
function navigate(p) {
  currentPage=p;
  const t={dashboard:'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',projects:'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',tasks:'Ø§Ù„Ù…Ù‡Ø§Ù…',team:'ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„',reports:'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',calendar:'Ø§Ù„ØªÙ‚ÙˆÙŠÙ…',settings:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'};
  document.getElementById('pTitle').textContent=t[p]; buildNav(); render();
}

// ============================================================
// DATA
// ============================================================
function showLoading(){document.getElementById('loadingOverlay').classList.add('show')}
function hideLoading(){document.getElementById('loadingOverlay').classList.remove('show')}

async function loadAllData() {
  if(!db) return;
  showLoading();
  try {
    const [pR,tR,mR] = await Promise.all([
      db.from('projects').select('*').order('created_at',{ascending:false}),
      db.from('tasks').select('*').order('created_at',{ascending:false}),
      db.from('team_members').select('*').order('created_at',{ascending:false}),
    ]);
    projects = pR.data||[]; tasks = tR.data||[]; teamMembers = mR.data||[];
    console.log(`ğŸ“Š Loaded: ${projects.length} projects, ${tasks.length} tasks, ${teamMembers.length} members`);
  } catch(e) { console.error('Load error:',e); }
  hideLoading();
}

// ============================================================
// HELPERS
// ============================================================
function pb(v){const c=v>=75?'#059669':v>=50?'#0284C7':v>=25?'#F59E0B':'#DC2626';return`<div class="pr"><div class="pt"><div class="pf" style="width:${v}%;background:${c}"></div></div><span class="pl" style="color:${c}">${v}%</span></div>`;}
function stb(s){const m={'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°':'act','Ù…ÙƒØªÙ…Ù„':'comp','Ù…ØªØ£Ø®Ø±':'late','Ø¬Ø¯ÙŠØ¯':'new'};return`<span class="badge b-${m[s]||'new'}"><span class="bd"></span>${s}</span>`;}
function prib(p){const m={'Ø¹Ø§Ù„ÙŠ':'h','Ù…ØªÙˆØ³Ø·':'m','Ù…Ù†Ø®ÙØ¶':'l'};return`<span class="prio p-${m[p]||'m'}">${p}</span>`;}
function es(icon,title,desc,btn,act){return`<div class="es"><div class="es-i">${icon}</div><div class="es-t">${title}</div><div class="es-d">${desc}</div>${btn?`<button class="btn-p" onclick="${act}">${btn}</button>`:''}</div>`;}

// ============================================================
// RENDER PAGES
// ============================================================
function render() {
  const c=document.getElementById('pageC');
  switch(currentPage){
    case'dashboard':c.innerHTML=rDash();break;case'projects':c.innerHTML=rProj();break;
    case'tasks':c.innerHTML=rTask();break;case'team':c.innerHTML=rTeam();break;
    case'reports':c.innerHTML=rRep();break;case'calendar':c.innerHTML=rCal();break;
    case'settings':c.innerHTML=rSet();break;
  }
}

function rDash(){
  const tp=projects.length,at=tasks.filter(t=>t.status==='Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°').length,ct=tasks.filter(t=>t.status==='Ù…ÙƒØªÙ…Ù„').length,lp=projects.filter(p=>p.status==='Ù…ØªØ£Ø®Ø±').length;
  let h=`<div class="sg">
    <div class="sc"><div class="sc-bg" style="background:#DBEAFE"></div><div><div class="si" style="background:#DBEAFE">${I.proj.replace(/currentColor/g,'#0284C7')}</div></div><div><div class="sv">${tp}</div><div class="sl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div></div></div>
    <div class="sc"><div class="sc-bg" style="background:#FEF3C7"></div><div><div class="si" style="background:#FEF3C7">${I.task.replace(/currentColor/g,'#F59E0B')}</div></div><div><div class="sv">${at}</div><div class="sl">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©</div></div></div>
    <div class="sc"><div class="sc-bg" style="background:#D1FAE5"></div><div><div class="si" style="background:#D1FAE5"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg></div></div><div><div class="sv">${ct}</div><div class="sl">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div></div></div>
    <div class="sc"><div class="sc-bg" style="background:#FEE2E2"></div><div><div class="si" style="background:#FEE2E2"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#DC2626" stroke-width="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg></div></div><div><div class="sv">${lp}</div><div class="sl">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</div></div></div>
  </div>`;
  if(!projects.length&&!tasks.length){
    h+=`<div class="card">${es('<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="1.5"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>','Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹','Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø£ÙˆÙ„','+ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯','showAddProject()')}</div>`;
  } else {
    h+=`<div class="g2"><div class="card"><div class="card-h"><span class="card-t">Ù†Ø³Ø¨Ø© Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span></div><div style="display:flex;flex-direction:column;gap:18px">${projects.map(p=>`<div style="display:flex;align-items:center;gap:16px"><span style="font-size:13px;font-weight:600;color:#1E293B;min-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.name}</span><div style="flex:1">${pb(p.progress||0)}</div></div>`).join('')}</div></div>`;
    h+=`<div class="card"><div class="card-h"><span class="card-t">Ø¢Ø®Ø± Ø§Ù„Ù…Ù‡Ø§Ù…</span></div><div style="display:flex;flex-direction:column;gap:12px">${tasks.slice(0,5).map(t=>`<div class="ti"><div style="display:flex;align-items:center;gap:12px"><div style="width:32px;height:32px;border-radius:8px;background:${t.status==='Ù…ÙƒØªÙ…Ù„'?'#D1FAE5':t.status==='Ù…ØªØ£Ø®Ø±'?'#FEE2E2':'#DBEAFE'};display:flex;align-items:center;justify-content:center"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${t.status==='Ù…ÙƒØªÙ…Ù„'?'#059669':t.status==='Ù…ØªØ£Ø®Ø±'?'#DC2626':'#0284C7'}" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg></div><div><div style="font-size:13px;font-weight:600;color:#1E293B">${t.title}</div><div style="font-size:11px;color:#94A3B8">${t.project_name||''}</div></div></div>${stb(t.status)}</div>`).join('')}</div></div></div>`;
  }
  return h;
}

function rProj(){
  let h=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px"><div style="font-size:14px;color:#64748B">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <strong style="color:#0F172A">${projects.length}</strong></div><button class="btn-p" onclick="showAddProject()">${I.plus} Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</button></div>`;
  if(!projects.length) h+=`<div class="card">${es('<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="1.5"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>','Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹','Ø£Ø¶Ù Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø£ÙˆÙ„','+ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹','showAddProject()')}</div>`;
  else h+=`<div class="g3">${projects.map(p=>`<div class="pc-card"><div style="display:flex;justify-content:space-between;margin-bottom:16px">${stb(p.status)}${prib(p.priority)}</div><h3 style="font-size:15px;font-weight:700;color:#0F172A;margin-bottom:8px;line-height:1.5">${p.name}</h3><div style="font-size:12px;color:#94A3B8;margin-bottom:16px">Ø§Ù„Ù…Ø¯ÙŠØ±: ${p.manager||'-'}</div>${pb(p.progress||0)}<div class="pm"><div class="pm-i">ğŸ“… ${p.end_date||'-'}</div><div class="pm-i">ğŸ‘¥ ${p.team_count||0} Ø¹Ø¶Ùˆ</div></div><div style="margin-top:12px"><button class="btn-sm" onclick="delProject(${p.id})" title="Ø­Ø°Ù">${I.del}</button></div></div>`).join('')}</div>`;
  return h;
}

function rTask(){
  let h=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px"><div style="font-size:14px;color:#64748B">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <strong style="color:#0F172A">${tasks.length}</strong></div><button class="btn-p" onclick="showAddTask()">${I.plus} Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button></div>`;
  if(!tasks.length) h+=`<div class="card">${es('<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="1.5"><path d="M11 18H3"/><path d="m15 18 2 2 4-4"/><path d="M16 12H3"/><path d="M16 6H3"/></svg>','Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…','Ø£Ø¶Ù Ù…Ù‡Ù…ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰','+ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©','showAddTask()')}</div>`;
  else h+=`<div class="card" style="padding:0;overflow:hidden"><table class="dt"><thead><tr><th>Ø§Ù„Ù…Ù‡Ù…Ø©</th><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th><th>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th><th>Ø­Ø°Ù</th></tr></thead><tbody>${tasks.map(t=>`<tr><td style="font-weight:600;color:#1E293B">${t.title}</td><td style="color:#64748B;font-size:12px">${t.project_name||''}</td><td><div class="as"><div class="as-a">${(t.assignee||'Øº').charAt(0)}</div><span style="font-size:12px;color:#64748B">${t.assignee||'-'}</span></div></td><td>${stb(t.status)}</td><td>${prib(t.priority)}</td><td style="font-size:12px;color:#64748B">${t.due_date||'-'}</td><td><button class="btn-sm" onclick="delTask(${t.id})">${I.del}</button></td></tr>`).join('')}</tbody></table></div>`;
  return h;
}

function rTeam(){
  let h=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px"><div style="font-size:14px;color:#64748B">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: <strong style="color:#0F172A">${teamMembers.length}</strong></div><button class="btn-p" onclick="showAddMember()">${I.plus} Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ</button></div>`;
  if(!teamMembers.length) h+=`<div class="card">${es('<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="1.5"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>','Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡','Ø£Ø¶Ù Ø£Ø¹Ø¶Ø§Ø¡ ÙØ±ÙŠÙ‚Ùƒ','+ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ','showAddMember()')}</div>`;
  else h+=`<div class="g3">${teamMembers.map(m=>`<div class="tc"><div class="t-av">${m.name.charAt(0)}</div><div style="font-size:16px;font-weight:700;color:#0F172A;margin-bottom:4px">${m.name}</div><div style="font-size:13px;color:#0284C7;font-weight:600;margin-bottom:4px">${m.role||'-'}</div><div style="font-size:12px;color:#94A3B8;margin-bottom:16px">${m.department||'-'}</div><button class="btn-sm" onclick="delMember(${m.id})" style="margin:0 auto">${I.del}</button></div>`).join('')}</div>`;
  return h;
}

function rRep(){
  const r=[{t:'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡',d:'Ù…Ù„Ø®Øµ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',c:'#0284C7'},{t:'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ§Øª',d:'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',c:'#059669'},{t:'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ø·Ø±',d:'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±',c:'#DC2626'},{t:'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯',d:'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',c:'#7C3AED'},{t:'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª',d:'Ø§Ù„Ù…Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©',c:'#F59E0B'},{t:'ØªÙ‚Ø±ÙŠØ± Ù…Ø®ØµØµ',d:'Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±',c:'#64748B'}];
  return`<div class="g3">${r.map(x=>`<div class="rc"><div class="rc-i" style="background:${x.c}15"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="${x.c}" stroke-width="2"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg></div><div style="font-size:15px;font-weight:700;color:#0F172A;margin-bottom:6px">${x.t}</div><div style="font-size:12px;color:#94A3B8;line-height:1.6">${x.d}</div></div>`).join('')}</div>`;
}

function rCal(){
  const d=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
  let c=d.map(x=>`<div class="ch">${x}</div>`).join('');
  for(let i=1;i<=28;i++){const td=i===25;c+=`<div class="cc${td?' today':''}"><span class="cd${td?' today':''}">${i}</span></div>`;}
  return`<div class="card"><div class="card-h"><h3 style="font-size:18px;font-weight:700;color:#0F172A">ÙØ¨Ø±Ø§ÙŠØ± 2026</h3></div><div class="cg">${c}</div></div>`;
}

function rSet(){
  return`<div class="g2"><div class="card"><div class="card-t" style="margin-bottom:20px">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</div><div class="fg"><label>Ø§Ù„Ø§Ø³Ù…</label><input class="si-inp" placeholder="Ø§Ù„Ø§Ø³Ù…"></div><div class="fg"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯</label><input class="si-inp" placeholder="email" dir="ltr" style="text-align:left"></div><div class="fg"><label>Ø§Ù„ÙˆØ¸ÙŠÙØ©</label><input class="si-inp" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰"></div><button class="btn-p" style="margin-top:8px">Ø­ÙØ¸</button></div><div><div class="card"><div class="card-t" style="margin-bottom:20px">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>${['Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª|on','Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†|off'].map(s=>{const[l,st]=s.split('|');return`<div style="display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid #F1F5F9"><span style="font-size:14px;font-weight:600;color:#1E293B">${l}</span><div class="tog ${st}"><div class="tog-k"></div></div></div>`;}).join('')}</div></div></div>`;
}

// ============================================================
// MODALS & CRUD
// ============================================================
function showModal(h){document.getElementById('modalC').innerHTML=h;document.getElementById('modal').classList.add('show');}
function closeModal(){document.getElementById('modal').classList.remove('show');}

function showAddProject(){
  showModal(`<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
    <div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label><input id="pN" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"></div>
    <div class="fg"><label>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><input id="pM" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><div class="fg"><label>Ø§Ù„Ø­Ø§Ù„Ø©</label><select id="pS"><option>Ø¬Ø¯ÙŠØ¯</option><option>Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option>Ù…ÙƒØªÙ…Ù„</option><option>Ù…ØªØ£Ø®Ø±</option></select></div><div class="fg"><label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label><select id="pPr"><option>Ø¹Ø§Ù„ÙŠ</option><option>Ù…ØªÙˆØ³Ø·</option><option>Ù…Ù†Ø®ÙØ¶</option></select></div></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><div class="fg"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label><input id="pSD" type="date"></div><div class="fg"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input id="pED" type="date"></div></div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px"><div class="fg"><label>Ø§Ù„ÙØ±ÙŠÙ‚</label><input id="pT" type="number" value="0" min="0"></div><div class="fg"><label>Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² %</label><input id="pPg" type="number" value="0" min="0" max="100"></div><div class="fg"><label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</label><input id="pB" type="number" value="0" min="0"></div></div>
    <div class="m-acts"><button class="btn-p" onclick="addProject()">Ø¥Ø¶Ø§ÙØ©</button><button class="btn-c" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button></div>`);
}

async function addProject(){
  const n=document.getElementById('pN').value.trim();if(!n){alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹');return;}
  showLoading();
  const{data,error}=await db.from('projects').insert([{name:n,manager:document.getElementById('pM').value||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',status:document.getElementById('pS').value,priority:document.getElementById('pPr').value,start_date:document.getElementById('pSD').value||null,end_date:document.getElementById('pED').value||null,team_count:parseInt(document.getElementById('pT').value)||0,progress:parseInt(document.getElementById('pPg').value)||0,budget:parseFloat(document.getElementById('pB').value)||0}]).select();
  if(error){alert('Ø®Ø·Ø£: '+error.message);hideLoading();return;}
  projects.unshift(data[0]);closeModal();hideLoading();render();
}
async function delProject(id){if(!confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ'))return;showLoading();await db.from('projects').delete().eq('id',id);projects=projects.filter(p=>p.id!==id);hideLoading();render();}

function showAddTask(){
  const o=projects.length?projects.map(p=>`<option value="${p.id}" data-name="${p.name}">${p.name}</option>`).join(''):'<option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹</option>';
  showModal(`<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
    <div class="fg"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label><input id="tT" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©"></div>
    <div class="fg"><label>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><select id="tP">${o}</select></div>
    <div class="fg"><label>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label><input id="tA" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><div class="fg"><label>Ø§Ù„Ø­Ø§Ù„Ø©</label><select id="tS"><option>Ø¬Ø¯ÙŠØ¯</option><option>Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option>Ù…ÙƒØªÙ…Ù„</option><option>Ù…ØªØ£Ø®Ø±</option></select></div><div class="fg"><label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label><select id="tPr"><option>Ø¹Ø§Ù„ÙŠ</option><option>Ù…ØªÙˆØ³Ø·</option><option>Ù…Ù†Ø®ÙØ¶</option></select></div></div>
    <div class="fg"><label>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label><input id="tD" type="date"></div>
    <div class="m-acts"><button class="btn-p" onclick="addTask()">Ø¥Ø¶Ø§ÙØ©</button><button class="btn-c" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button></div>`);
}
async function addTask(){
  const t=document.getElementById('tT').value.trim();if(!t){alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†');return;}
  const sel=document.getElementById('tP');const pid=sel.value?parseInt(sel.value):null;const pn=sel.options[sel.selectedIndex]?.dataset?.name||'';
  showLoading();
  const{data,error}=await db.from('tasks').insert([{title:t,project_id:pid,project_name:pn,assignee:document.getElementById('tA').value||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',status:document.getElementById('tS').value,priority:document.getElementById('tPr').value,due_date:document.getElementById('tD').value||null}]).select();
  if(error){alert('Ø®Ø·Ø£: '+error.message);hideLoading();return;}
  tasks.unshift(data[0]);closeModal();hideLoading();render();
}
async function delTask(id){if(!confirm('Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ'))return;showLoading();await db.from('tasks').delete().eq('id',id);tasks=tasks.filter(t=>t.id!==id);hideLoading();render();}

function showAddMember(){
  showModal(`<h3>Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</h3>
    <div class="fg"><label>Ø§Ù„Ø§Ø³Ù… *</label><input id="mN" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"></div>
    <div class="fg"><label>Ø§Ù„ÙˆØ¸ÙŠÙØ©</label><input id="mR" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ"></div>
    <div class="fg"><label>Ø§Ù„Ù‚Ø³Ù…</label><input id="mD" placeholder="Ø§Ù„Ù‚Ø³Ù…"></div>
    <div class="fg"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯</label><input id="mE" placeholder="email" dir="ltr" style="text-align:left"></div>
    <div class="m-acts"><button class="btn-p" onclick="addMember()">Ø¥Ø¶Ø§ÙØ©</button><button class="btn-c" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button></div>`);
}
async function addMember(){
  const n=document.getElementById('mN').value.trim();if(!n){alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…');return;}
  showLoading();
  const{data,error}=await db.from('team_members').insert([{name:n,role:document.getElementById('mR').value||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',department:document.getElementById('mD').value||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',email:document.getElementById('mE').value||''}]).select();
  if(error){alert('Ø®Ø·Ø£: '+error.message);hideLoading();return;}
  teamMembers.unshift(data[0]);closeModal();hideLoading();render();
}
async function delMember(id){if(!confirm('Ø­Ø°Ù Ø§Ù„Ø¹Ø¶ÙˆØŸ'))return;showLoading();await db.from('team_members').delete().eq('id',id);teamMembers=teamMembers.filter(m=>m.id!==id);hideLoading();render();}

// ============================================================
// INIT
// ============================================================
window.addEventListener('DOMContentLoaded', function() {
  console.log('ğŸš€ PMS Loading...');
  
  // Setup event listeners
  document.getElementById('authBtn').addEventListener('click', function(e) {
    e.preventDefault();
    console.log('ğŸ–±ï¸ Login button clicked');
    handleAuth();
  });
  
  document.getElementById('toggleLink').addEventListener('click', function(e) {
    e.preventDefault();
    toggleAuthMode();
  });
  
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !document.getElementById('loginPage').classList.contains('hidden')) {
      handleAuth();
    }
  });

  // Init Supabase
  if (initSupabase()) {
    checkSession();
  }
});
</script>
</body>
</html>
